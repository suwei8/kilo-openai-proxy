
## 建议的 .env（示例）

```
PORT=8033
HEADLESS=false
USER_DATA_DIR=.userdata
GEMINI_URL=https://gemini.google.com/app

WAIT_READY_MS=1500
MAX_ANSWER_MS=60000
STABLE_MS=1200
AFTER_INPUT_SETTLE_MS=800

# 仅用回车提交（极端兜底时再开启）
FORCE_ENTER_ONLY=false
```

---

## 验证建议（快速串测）

1. **健康检查**

```powershell
curl http://127.0.0.1:8033/healthz
curl http://127.0.0.1:8033/status
```

2. **Debug/节点数**

```powershell
curl http://127.0.0.1:8033/debug
curl http://127.0.0.1:8033/gemini-nodes
```

3. **非流式**

```powershell
$body = @{model='gemini-webui'; messages=@(@{role='user'; content='用中文解释“二分查找”的核心思想'})} | ConvertTo-Json -Depth 5
Invoke-RestMethod -Uri 'http://127.0.0.1:8033/v1/chat/completions' -Method POST -ContentType 'application/json' -Body $body
```

4. **SSE 流式**
   若你已有 Python/PowerShell 测试脚本，直接走 `stream: true` 验证即可。

---

如果你希望**进一步“极限瘦身”（去掉所有诊断端点/多重写入策略）**，我也可以给你一份“最小可用版”（<600 行），但当前这版在**稳定性与可维护性**上更平衡：

* 冗余已清理；
* 关键路径统一；
* 诊断面保留，便于继续排障。
